name: Test Hook
on: [push]

permissions:
  contents: read
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Test get variable exported by push-to-another-repository
        run: echo $DESTINATION_CLONED_DIRECTORY
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub."
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: yarn add hardhat
      - run: npx hardhat compile --force
      - run: npx hardhat test
      - run: echo "üçè This job's status is ${{ job.status }}."
      - name: Run foundry tests
        run: forge test --ffi -vv
  port-to-public-repo:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Pushes to public repo
        uses: cpina/github-action-push-to-another-repository@v1.4.2
        env:
          SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source-directory: .
          target-directory: /
          destination-github-username: 'curio-eth'
          destination-repository-name: 'engine-public' # change
          user-email: yijia@0xcurio.com
          commit-message: See ORIGIN_COMMIT from $GITHUB_REF
          target-branch: main
